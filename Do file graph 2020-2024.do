use "C:\Users\ganam\Dropbox\Datathon Anas Ideas\Append files\UNHCR_COL_full part 2 2023-2024 - clean.dta" 
describe AppliedRefugee yr quarter MonitoringDate CountryofAsylum testorreal remoteorinperson stafforpartner YesDisplaced YesOver15 Consent departamento nationality crossedborder leftresidence notsafehere DepartureDate ArriveThiscountry ArriveThisplace TransportMethod TransportMethod_bus TransportMethod_taxi TransportMethod_car TransportMethod_plane TransportMethod_boat TransportMethod_walk TransportMethod_hitchHiking TransportMethod_other progres_groupsize Childinschool Childvirtualed Childwhynotschool Childwhynotschool_nodocs Childwhynotschool_nomoney Childwhynotschool_failedschool Childwhynotschool_childwork Childwhynotschool_fearschool Childwhynotschool_disease Childwhynotschool_disability Childwhynotschool_helphome Childwhynotschool_familynot Childwhynotschool_noschools Childwhynotschool_nointerest Childwhynotschool_pregnancy Childwhynotschool_nospot Childwhynotschool_notransport Childwhynotschool_discrimnation Childwhynotschool_discrimethnic Childwhynotschool_childrecruit Childwhynotschool_finished Childwhynotschool_recentlyarrive Childwhynotschool_intransit Childwhynotschool_noinfo Childwhynotschool_toolate Childwhynotschool_nolanguage Childwhynotschool_other childborn2015 childbornCol childbornCol_BirthcertificateCol childbornCol_Certificatelivebirt childbornCol_otherdoc childbornCol_dontknowdoc childbornCol_nonebornCol chilbornColnote SpecificNeeds SpecificNeeds_disability SpecificNeeds_treatment SpecificNeeds_treatmentyesaccess SpecificNeeds_unacompanied SpecificNeeds_elderly SpecificNeeds_pregnant SpecificNeeds_lactating SpecificNeeds_singlehead SpecificNeeds_victimsurvivor SpecificNeeds_none pregnantweeks pregnantlastdoc pregnantlastdoc_first pregnantlastdoc_second pregnantlastdoc_third7 pregnantlastdoc_third8 pregnantlastdoc_third9 pregnantlastdoc_nocheck pregnantlastdoc_noremem ethnicity FamiliyLeft householdLeftbehind reasons_stayed reasons_stayed_health_prob reasons_stayed_lack_funds reasons_stayed_lack_docs reasons_stayed_security reasons_stayed_work_study reasons_stayed_care_property reasons_stayed_caring_dependant reasons_stayed_old_age reasons_stayed_stayed reasons_stayed_stayedothercountr reasons_stayed_returned reasons_stayed_continuedothercou reasons_stayed_dont_know reasons_stayed_notell reasons_stayed_other minorsleft prevdeport prevdeport_yesdeport prevdeport_yesForcedreturn prevdeport_yesRefusedentry prevdeport_none deportCountry deportCountry_Argentina deportCountry_Aruba deportCountry_Belize deportCountry_Bolivia deportCountry_Brazil deportCountry_Chile deportCountry_Colombia deportCountry_CostaRica deportCountry_Cuba deportCountry_Curacao deportCountry_Ecuador deportCountry_elSalvador deportCountry_USA deportCountry_Guatemala deportCountry_Guyana deportCountry_Honduras deportCountry_Mexico deportCountry_Nicaragua deportCountry_Panama deportCountry_Paraguay deportCountry_Peru deportCountry_RepublicaDominican deportCountry_TrinidadYTobago deportCountry_Uruguay deportCountry_Venezuela deportCountry_other deportCountry_notsaid RouteIncident RouteIncidentType RouteIncidentType_theft RouteIncidentType_eviction RouteIncidentType_evictionthreat RouteIncidentType_threat RouteIncidentType_fraud RouteIncidentType_homicide RouteIncidentType_physicalAssaul RouteIncidentType_sexualAssault RouteIncidentType_abduction RouteIncidentType_Exploitsex RouteIncidentType_Exploitwork RouteIncidentType_detention RouteIncidentType_bribery RouteIncidentType_deportation RouteIncidentType_destrProperty RouteIncidentType_notell RouteIncidentType_other RouteIncidentType_forcedisappear RouteIncidentType_torture RouteIncidentType_forcedrecruit RouteIncidentType_despojo RouteIncidentType_displaced RouteIncidentType_confine RouteIncidentType_extors RouteIncidentnotdisplaced homicide homicide_orgin homicide_trip homicide_asylum homicide_othercity homicide_preferNot physicalAssault physicalAssault_orgin physicalAssault_trip physicalAssault_asylum physicalAssault_othercity physicalAssault_preferNot sexualAssault sexualAssault_orgin sexualAssault_trip sexualAssault_asylum sexualAssault_othercity sexualAssault_preferNot abductionORkidnapping abductionORkidnapping_orgin abductionORkidnapping_trip abductionORkidnapping_asylum abductionORkidnapping_othercity abductionORkidnapping_preferNot exploitationsex exploitationsex_orgin exploitationsex_trip exploitationsex_asylum exploitationsex_othercity exploitationsex_preferNot exploitationwork exploitationwork_orgin exploitationwork_trip exploitationwork_asylum exploitationwork_othercity exploitationwork_preferNot arrestORdetention arrestORdetention_orgin arrestORdetention_trip arrestORdetention_asylum arrestORdetention_othercity arrestORdetention_preferNot threat threat_orgin threat_trip threat_asylum threat_othercity threat_preferNot fraud fraud_orgin fraud_trip fraud_asylum fraud_othercity fraud_preferNot theft theft_orgin theft_trip theft_asylum theft_othercity theft_preferNot eviction eviction_orgin eviction_trip eviction_asylum eviction_othercity eviction_preferNot evictionthreat evictionthreat_orgin evictionthreat_trip evictionthreat_asylum evictionthreat_othercity evictionthreat_preferNot destructionProperty destructionProperty_orgin destructionProperty_trip destructionProperty_asylum destructionProperty_othercity destructionProperty_preferNot dispossetion dispossetion_orgin dispossetion_trip dispossetion_asylum dispossetion_othercity dispossetion_preferNot forceddisplaced forceddisplaced_orgin forceddisplaced_trip forceddisplaced_asylum forceddisplaced_othercity forceddisplaced_preferNot RiskYes RiskReturn RiskReturn_riskPreferNot RiskReturn_threat RiskReturn_extorsion RiskReturn_violence RiskReturn_insecurity RiskReturn_armedgroup RiskReturn_assaulted RiskReturn_recruited RiskReturn_subsistence RiskReturn_lackfood RiskReturn_medical RiskReturn_healthrisk RiskReturn_other RiskYesStay RiskStay RiskStay_riskPreferNot RiskStay_threat RiskStay_extorsion RiskStay_violence RiskStay_insecurity RiskStay_armedgroup RiskStay_assaulted RiskStay_recruited RiskStay_subsistence RiskStay_lackfood RiskStay_medical RiskStay_healthrisk RiskStay_other documentation documentation_passport documentation_passportexp documentation_id documentation_idexp documentation_birthcertif documentation_none documentation_notell documentation_other NeverRegistered NeverRegistered_yesbetween011y NeverRegistered_yesbetween1217y NeverRegistered_yes18 NeverRegistered_noallregistered CountriesNoRegistered CountriesNoRegistered_Argentina CountriesNoRegistered_Aruba CountriesNoRegistered_Belize CountriesNoRegistered_Bolivia CountriesNoRegistered_Brazil CountriesNoRegistered_Chile CountriesNoRegistered_Colombia CountriesNoRegistered_CostaRica CountriesNoRegistered_Cuba CountriesNoRegistered_Curacao CountriesNoRegistered_Ecuador CountriesNoRegistered_elSalvador CountriesNoRegistered_USA CountriesNoRegistered_Guatemala CountriesNoRegistered_Guyana CountriesNoRegistered_Honduras CountriesNoRegistered_Mexico CountriesNoRegistered_Nicaragua CountriesNoRegistered_Panama CountriesNoRegistered_Paraguay CountriesNoRegistered_Peru CountriesNoRegistered_RepDominic CountriesNoRegistered_TrinidadTo CountriesNoRegistered_Uruguay CountriesNoRegistered_Venezuela CountriesNoRegistered_other CountriesNoRegistered_notsaid RegularEntry EtpvRegistration EptvRegistrationFamily PreRegNF PreRegNF_waitingREGappointment PreRegNF_Lackofknowledge PreRegNF_accessproblems PreRegNF_internetaccess PreRegNF_couldnotcompleteprocess PreRegNF_Lackofidentity PreRegNF_hasnotyethadtime PreRegNF_withoutproofofmyentry PreRegNF_otherEtp PreRegNF2 PreRegNF2_puntobio PreRegNF2_citabio PreRegNF2_docubio PreRegNF2_cumpcitabio PreRegNF2_waitingBIOappointment PreRegNF2_otherbio AppliedRefugee PTPRegistration Asylumapplicationwithdrawn noasylum noasylum_IdontknowwhenIwillbe noasylum_noworklaissezpasser noasylum_MCdoesnotwanttorenew noasylum_Iamnotafraidtoreturn noasylum_noplanstoliveinColombia noasylum_notincludemyfamily noasylum_fastertoobtaindocument noasylum_sometoldmethatitsbetter noasylum_otherwithreason AppliedRefugeeIDP NotAsylum NotAsylum_lack_of_docume NotAsylum_lack_of_inform NotAsylum_costs NotAsylum_not_allowed_in NotAsylum_lack_time NotAsylum_distance NotAsylum_other Notnarrativedocument docResidence medicalAttention medicalType medicalType_hospital medicalType_center medicalType_clinic medicalType_other medicalReceived whynotMedical whynotMedical_nomoney whynotMedical_noinsurance whynotMedical_noID whynotMedical_noinfo whynotMedical_feararrested whynotMedical_distance whynotMedical_notavailable whynotMedical_denied whynotMedical_other affiliationType howaffiliationType howaffiliationType_Affiliatework howaffiliationType_Beneficiaryfa howaffiliationType_Sisbén howaffiliationType_Otheraffi pressneeds id confined confined_orgin confined_trip confined_asylum confined_othercity confined_preferNot deportation deportation_orgin deportation_trip deportation_asylum deportation_othercity deportation_preferNot CountryReturn
codebook deportation_preferNot
ds, has(type string)
foreach var in `r(varlist)' {
    encode `var', gen(`var'_cat)
}
ds, has(type string)
foreach var in `r(varlist)' {
    rename `var' `var'_str
}
ds *_cat
foreach var in `r(varlist)' {
    local newname : subinstr local var "_cat" "", all
    rename `var' `newname'
}
save "C:\Users\ganam\Dropbox\Datathon Anas Ideas\Append files\UNHCR_COL_full part 2 2023-2024 - clean.dta", replace
save "C:\Users\ganam\Dropbox\Datathon Anas Ideas\Append files\UNHCR_COL_full part 2 2023-2024 - clean.dta", replace

*ds, has(vallabel) detecta todas las variables que tienen etiquetas ///
//de valores///
//decode convierte los valores numéricos con etiquetas///
/// en variables string, usando las etiquetas como texto.



describe FeelSafe
codebook FeelSafe
label define FeelSafe 1 "StronglyDisagree", modify
label define FeelSafe 2 "Disagree", modify
label define FeelSafe 3 "Undecided", modify
label define FeelSafe 4 "Agree", modify
label define FeelSafe 5 "StronglyAgree", modify
graph bar, over( FeelSafe )

Factor analysis

factor RouteIncidentType_homicide RouteIncidentType_physAssault RouteIncidentType_sexualAssault RouteIncidentType_abduction RouteIncidentType_Exploitsex RouteIncidentType_Exploitwork RouteIncidentType_torture , blanks(.3) factors(2)
rotate, blanks(.30)


graph bar RiskReturn_threat RiskReturn_extorsion RiskReturn_violence ///
RiskReturn_insecurity RiskReturn_armedgroup RiskReturn_assaulted ///
RiskReturn_recruited RiskReturn_subsistence RiskReturn_lackfood 
RiskReturn_medical RiskReturn_healthrisk , blanks(.3) factors(2)///

graph bar RiskReturn_threat RiskReturn_extorsion RiskReturn_violence RiskReturn_insecurity RiskReturn_armedgroup RiskReturn_assaulted RiskReturn_recruited RiskReturn_subsistence RiskReturn_lackfood RiskReturn_medical RiskReturn_healthrisk

*************Merge 2020-2022 and 2023-2024*****


*++++graphs

ds Childwhynotschool_*, has(type numeric)
foreach var of varlist `r(varlist)' {
    local newname = subinstr("`var'", "Childwhynotschool_", "child_noscho_", .)
    rename `var' `newname'
}
ds RouteIncidentType_*, has(type numeric)
foreach var of varlist `r(varlist)' {
    local newname = subinstr("`var'", "RouteIncidentType_", "RouteInci_", .)
    rename `var' `newname'
}
ds exploitationsex_*, has(type numeric)
foreach var of varlist `r(varlist)' {
    local newname = subinstr("`var'", "exploitationsex_", "explotSex_", .)
    rename `var' `newname'
}ds CopingMechanism1_*, has(type numeric)
foreach var of varlist `r(varlist)' {
local newname = subinstr("`var'", "CopingMechanism1_", "CopMechan_", .)
rename `var' `newname'
}
ds CopingMechanism2_*, has(type numeric)
foreach var of varlist `r(varlist)' {
local newname = subinstr("`var'", "CopingMechanism2_", "CopMechan_", .)
rename `var' `newname'
ds SpecificNeeds_*, has(type numeric)
foreach var of varlist `r(varlist)' {
local newname = subinstr("`var'", "SpecificNeeds_", "SficNeed_", .)
rename `var' `newname'
}


pwcorr dependencyRatio TotalAdult TotalAdultFemale TotalAdultMale TotalMinor , sig sta
> r(0.05)


replace Discriminated =1 if Discriminated_01 ==4
replace Discriminated =2 if Discriminated_01 ==2
replace Discriminated =3 if Discriminated_01 ==5
replace Discriminated =4 if Discriminated_01 ==1
replace Discriminated =5 if Discriminated_01 ==3
label define Discriminated 1 "StronglyDisagree", modify
label define Discriminated 2 "Disagree", modify
label define Discriminated 3 "newtral", modify
label define Discriminated 4 "Agree", modify
label define Discriminated 5 "StronglyAgree", modify

